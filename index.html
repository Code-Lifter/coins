<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Token Board V4.1</title>
    <style>
        /* --- CSS STYLES --- */
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #222;
            color: white;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: fixed;
            touch-action: none;
        }

        /* Setup Screen Overlay */
        #setup-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; z-index: 99999;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        
        .input-group { width: 70%; margin-bottom: 20px; display: flex; flex-direction: column; gap: 5px; }
        label { color: #888; font-size: 0.8rem; text-align: left; margin-left: 5px; }
        input { 
            padding: 15px; font-size: 1.1rem; width: 100%; box-sizing: border-box;
            border-radius: 8px; border: 1px solid #444; 
            background: #222; color: white; text-align: center; 
        }
        button.start-btn { 
            padding: 15px 40px; font-size: 1.2rem; margin-top: 10px;
            background-color: #27ae60; color: white; 
            border: none; border-radius: 8px; cursor: pointer; 
        }

        /* --- NEW WIN MODAL STYLE --- */
        #win-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.92); /* Darker background */
            z-index: 5000;
            display: none; 
            flex-direction: column;
            align-items: center; justify-content: center;
            backdrop-filter: blur(8px);
            animation: fadeIn 0.4s ease;
        }

        /* Line 1: "You have reached" */
        #win-screen p { 
            font-size: 1.2rem; 
            color: #888; 
            margin: 0; 
            text-transform: uppercase; 
            letter-spacing: 3px;
            font-weight: bold;
        }

        /* Line 2: The Big Number */
        #win-screen h1 { 
            font-size: 9rem; /* Massive text */
            margin: 10px 0 40px 0; 
            color: #f1c40f; 
            line-height: 1;
            text-shadow: 0 0 30px rgba(241, 196, 15, 0.3); 
        }
        
        button.continue-btn {
            padding: 15px 40px; font-size: 1rem;
            background: transparent; 
            color: white; 
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50px; 
            cursor: pointer;
            transition: all 0.2s;
        }
        button.continue-btn:active { background: white; color: black; }

        /* --- UI ZONES --- */
        #token-bank {
            background-color: #2d2d2d;
            display: flex; justify-content: center; gap: 15px;
            height: 90px; align-items: center; z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); width: 100%;
        }

        #reset-btn {
            position: absolute; bottom: 30px; left: 20px;
            width: 70px; height: 70px;
            background-color: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.7);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px; font-weight: bold; font-size: 0.75rem;
            cursor: pointer; z-index: 200; display: none;
            text-transform: uppercase; backdrop-filter: blur(5px);
        }
        #reset-btn:active { background-color: rgba(255, 255, 255, 0.2); transform: scale(0.95); }

        #trash-zone {
            position: absolute; bottom: 30px; right: 20px;
            width: 70px; height: 70px;
            border: 2px dashed #555; border-radius: 15px;
            display: flex; align-items: center; justify-content: center;
            color: #555; z-index: 5; transition: all 0.2s; user-select: none;
        }
        #trash-zone svg { width: 32px; height: 32px; }
        #trash-zone.hovered { background-color: rgba(231, 76, 60, 0.2); border-color: #e74c3c; color: #e74c3c; }

        #total-score {
            position: absolute; bottom: 30px; left: 0; right: 0; 
            text-align: center; font-size: 5rem; line-height: 1; font-weight: bold;
            color: rgba(255, 255, 255, 0.25); pointer-events: none; user-select: none; z-index: 1; 
        }

        .token {
            width: 60px; height: 60px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 1.2rem; color: #fff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5); cursor: grab; user-select: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.4); position: relative; 
            border: 3px solid rgba(255,255,255,0.15);
        }
        .token.dragging { box-shadow: 0 15px 30px rgba(0,0,0,0.5); transform: scale(1.15); border-color: white; cursor: grabbing; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    </style>
</head>
<body>

    <div id="setup-screen">
        <h2 style="color:#ddd; margin-bottom:20px;">Board Setup</h2>
        
        <div class="input-group">
            <label>COIN VALUES</label>
            <input type="text" id="coin-values" value="" placeholder="e.g. 1, 5, 10, 50">
        </div>

        <div class="input-group">
            <label>TARGET SCORE (Optional)</label>
            <input type="number" id="target-score" placeholder="e.g. 100">
        </div>

        <button class="start-btn" onclick="initGame()">Create Board</button>
    </div>

    <div id="win-screen">
        <p>YOU HAVE REACHED</p>
        <h1 id="win-display-score">0</h1>
        <button class="continue-btn" onclick="dismissWin()">Keep Playing</button>
    </div>

    <button id="reset-btn" onclick="resetGame()">RESET</button>
    <div id="total-score">0</div>
    
    <div id="trash-zone">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 4h-3.5l-1-1h-5l-1 1H5v2h14M6 19a2 2 0 002 2h8a2 2 0 002-2V7H6v12z"/>
        </svg>
    </div>
    
    <div id="token-bank"></div>
    <div id="player-zone"></div>

    <script>
        // --- CONFIG & STATE ---
        const bank = document.getElementById('token-bank');
        const trash = document.getElementById('trash-zone');
        const scoreDisplay = document.getElementById('total-score');
        const setupScreen = document.getElementById('setup-screen');
        const winScreen = document.getElementById('win-screen');
        const winDisplayScore = document.getElementById('win-display-score');
        const resetBtn = document.getElementById('reset-btn');
        
        const palette = [
            '#e74c3c', '#3498db', '#f1c40f', '#9b59b6', 
            '#2ecc71', '#e67e22', '#1abc9c', '#34495e', '#d35400', '#7f8c8d'
        ];

        let state = {
            active: false,
            score: 0,
            target: null, 
            won: false,   
            values: [],
            tokens: []
        };

        let globalZ = 1000;

        // --- INITIALIZATION ---
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('tokenBoardState');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    if(parsed.active && parsed.values.length > 0) {
                        state = parsed;
                        restoreGame();
                    }
                } catch(e) { console.log('Save file corrupt'); }
            }
        });

        function initGame() {
            const valInput = document.getElementById('coin-values').value;
            const targetInput = document.getElementById('target-score').value;
            
            const values = valInput.split(',').map(v => parseInt(v.trim())).filter(n => !isNaN(n));
            const target = parseInt(targetInput);

            if (values.length === 0) { alert("Please enter at least one coin value."); return; }

            state.values = values;
            state.target = isNaN(target) ? null : target;
            state.active = true;
            state.score = 0;
            state.won = false;
            state.tokens = [];
            
            saveState();
            renderBank();
            setupScreen.style.display = 'none';
            resetBtn.style.display = 'block';
        }

        function restoreGame() {
            renderBank();
            updateScoreDisplay();
            state.tokens.forEach(t => {
                createTokenDOM(t.value, t.x, t.y, t.id, t.z);
                if(t.z > globalZ) globalZ = t.z;
            });
            setupScreen.style.display = 'none';
            resetBtn.style.display = 'block';
        }

        function resetGame() {
            if(!confirm("Start a new game?")) return;
            localStorage.removeItem('tokenBoardState');
            location.reload();
        }

        function saveState() {
            localStorage.setItem('tokenBoardState', JSON.stringify(state));
        }

        function dismissWin() {
            winScreen.style.display = 'none';
        }

        // --- GAME LOGIC ---
        function checkWinCondition() {
            if (state.target !== null && state.score >= state.target && !state.won) {
                state.won = true; 
                winDisplayScore.textContent = state.score; // Updates the big number
                winScreen.style.display = 'flex'; 
                saveState();
            }
        }

        function updateScoreDisplay() {
            scoreDisplay.textContent = state.score;
        }

        function spawnToken(e, val, color) {
            e.preventDefault();
            const id = Date.now() + Math.random().toString(16).slice(2);
            const x = e.clientX - 30; 
            const y = e.clientY - 30; 
            globalZ++;
            const el = createTokenDOM(val, x, y, id, globalZ, color);
            startDrag(el, e, val, id, true);
        }

        function createTokenDOM(val, x, y, id, zIndex, colorOverride = null) {
            const el = document.createElement('div');
            el.className = 'token';
            el.textContent = val;
            el.style.position = 'absolute';
            el.style.left = x + 'px'; el.style.top = y + 'px'; el.style.zIndex = zIndex;
            el.id = 'tok-' + id;
            
            if(!colorOverride) {
                const idx = state.values.indexOf(val);
                el.style.backgroundColor = palette[idx % palette.length];
            } else {
                el.style.backgroundColor = colorOverride;
            }

            if(!colorOverride) { 
                el.addEventListener('pointerdown', (e) => startDrag(el, e, val, id, false));
            }
            document.body.appendChild(el);
            return el;
        }

        function startDrag(elem, startEvent, val, id, isNew) {
            elem.setPointerCapture(startEvent.pointerId);
            elem.classList.add('dragging');
            globalZ++; elem.style.zIndex = globalZ;

            const rect = elem.getBoundingClientRect();
            const shiftX = startEvent.clientX - rect.left;
            const shiftY = startEvent.clientY - rect.top;

            function onMove(e) {
                let nx = e.clientX - shiftX;
                let ny = e.clientY - shiftY;
                
                const maxX = window.innerWidth - elem.offsetWidth;
                const maxY = window.innerHeight - elem.offsetHeight;
                if (nx < 0) nx = 0; if (nx > maxX) nx = maxX;
                if (ny < 0) ny = 0; if (ny > maxY) ny = maxY;

                elem.style.left = nx + 'px';
                elem.style.top = ny + 'px';

                if (checkCollision(elem, trash)) trash.classList.add('hovered');
                else trash.classList.remove('hovered');
            }

            function onUp(e) {
                elem.removeEventListener('pointermove', onMove);
                elem.removeEventListener('pointerup', onUp);
                elem.classList.remove('dragging');
                trash.classList.remove('hovered');

                const currentX = parseFloat(elem.style.left);
                
                // 1. Trash Logic
                if (checkCollision(elem, trash)) {
                    if(!isNew) {
                        state.score -= val;
                        removeTokenFromState(id);
                    }
                    elem.remove();
                    updateScoreDisplay();
                    saveState();
                    return;
                }

                // 2. Bank Logic
                const bankRect = bank.getBoundingClientRect();
                if (e.clientY < bankRect.bottom) {
                     if(!isNew) {
                        state.score -= val;
                        removeTokenFromState(id);
                    }
                    elem.remove();
                    updateScoreDisplay();
                    saveState();
                    return;
                }

                // 3. Valid Drop
                if (isNew) {
                    state.score += val;
                    elem.addEventListener('pointerdown', (evt) => startDrag(elem, evt, val, id, false));
                }
                
                updateTokenState(id, val, currentX, parseFloat(elem.style.top), globalZ);
                updateScoreDisplay();
                
                checkWinCondition();
                
                saveState();
            }

            elem.addEventListener('pointermove', onMove);
            elem.addEventListener('pointerup', onUp);
        }

        // --- HELPERS ---
        function checkCollision(el1, el2) {
            const r1 = el1.getBoundingClientRect();
            const r2 = el2.getBoundingClientRect();
            return !(r1.right < r2.left || r1.left > r2.right || r1.bottom < r2.top || r1.top > r2.bottom);
        }

        function updateTokenState(id, val, x, y, z) {
            const existing = state.tokens.find(t => t.id === id);
            if (existing) { existing.x = x; existing.y = y; existing.z = z; } 
            else { state.tokens.push({ id, value: val, x, y, z }); }
        }

        function removeTokenFromState(id) {
            state.tokens = state.tokens.filter(t => t.id !== id);
        }
        function renderBank() {
            bank.innerHTML = '';
            state.values.forEach((val, index) => {
                const btn = document.createElement('div');
                btn.className = 'token bank-token';
                btn.textContent = val;
                btn.dataset.value = val;
                btn.style.backgroundColor = palette[index % palette.length];
                btn.addEventListener('pointerdown', (e) => spawnToken(e, val, palette[index % palette.length]));
                bank.appendChild(btn);
            });
        }
    </script>
</body>
</html>
